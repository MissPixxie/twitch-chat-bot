<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8" />
    <link rel="stylesheet" href="style.css" />
<script src="https://cdn.socket.io/4.8.1/socket.io.min.js"></script>
            <script>

              const socket = io("http://localhost:3000");
              socket.on("connect", (message) => {
                console.log("connected")
                socket.on("botMessage", (message) => {
                  switch(message) {
                    case "!love":
                    love();
                    break;
                    case "!feed":
                      hunger();
                      break;
                      case "!play":
                        fun();
                        break;
                        case "!bath":
                          bath();
                          break;
                          case "!sleep":
                            sleep();
                            break;
                  }
                })
              });

              const tamagotchi = { love: 0, hunger: 0, fun: 0, bath: 0, tired: 0 };

                // Funktionen check kollar så att värdena som dom olika känslo funktionerna försöker lägga till inte överstiger 10 eller
                // understiger 0 eftersom det är max och minimum
                function check(val, inc) {
                  var newval = val + inc;
                  if (newval > 10) {
                    newval = 10;
                  }
                  if (newval < 0) {
                    newval = 0;
                  }
                  return newval;
                }

                function sleep(ms) {
                  return new Promise((r) => setTimeout(r, ms));
                }

                // Stoppar rörelsen och bilderna och visar tamahappy och startar sedan rörelsen igen
                async function appreciation() {
                  stop();
                  var tama = document.getElementsByClassName("tamagotchi");
                  for (var i = 0; i < tama.length; i++) {
                    tama[i].style.display = "none";
                  }
                  tama[2].style.display = "block";
                  await sleep(1000);
                  tama[0].style.display = "block";
                  tama[2].style.display = "none";
                  stop();
                  start();
                }

                // Funktionen goSleep  tar bort bilderna på snigeln och ändrar ljuset när man klickar på knappen sova eller när tröttheten automatiskt blir 0
                // snigeln sover då en timme
                async function goSleep(ms) {
                  stop();
                  var tama = document.getElementsByClassName("tamagotchi");
                  for (var i = 0; i < tama.length; i++) {
                    tama[i].style.display = "none";
                  }
                  await sleep(ms);
                  tama[0].style.display = "block";
                  stop();
                  start();
                }

                // Funktionerna love, hunger, fun, bath och tired lägger till och tar bort värde ifrån objektet tamagotchi
                //och kontaktar sedan getValues funktionen för att den ska uppdatera mätaren samtidigt som man klickar på någon av knapparna
                function love() {
                  tamagotchi.love = check(tamagotchi.love, 5);
                  getValues();
                  appreciation();
                }

                function hunger() {
                  tamagotchi.hunger = check(tamagotchi.hunger, 3);
                  tamagotchi.tired = check(tamagotchi.tired, -1);

                  getValues();
                  appreciation();
                  closeOnFoodClick();
                }

                function fun() {
                  tamagotchi.fun = check(tamagotchi.fun, 5);
                  tamagotchi.love = check(tamagotchi.love, 1);
                  tamagotchi.hunger = check(tamagotchi.hunger, -2);
                  tamagotchi.bath = check(tamagotchi.bath, -1);
                  tamagotchi.tired = check(tamagotchi.tired, -2);

                  getValues();
                  appreciation();
                }

                function bath() {
                  tamagotchi.bath = check(tamagotchi.bath, 10);

                  getValues();
                  appreciation();
                }

                function tired() {
                  goSleep(5000);
                  tamagotchi.tired = check(tamagotchi.tired, 10);
                  tamagotchi.hunger = check(tamagotchi.hunger, -5);

                  getValues();
                }

                // Funktionen time tar bort värde ifrån objektet per timme
                function time() {
                  tamagotchi.love = check(tamagotchi.love, -2);
                  tamagotchi.hunger = check(tamagotchi.hunger, -1);
                  tamagotchi.fun = check(tamagotchi.fun, -2);
                  tamagotchi.bath = check(tamagotchi.bath, -1);
                  tamagotchi.tired = check(tamagotchi.tired, -1);
                  if (tamagotchi.tired == 0) {
                    goSleep(36000);
                    tamagotchi.tired = 10;
                  }
                  getValues();
                }
                setInterval(time, 360000);

                // getValues funktionen är kopplad till känslofunktionerna , den summerar känslorna och uppdaterar mätaren när man klickar på knapparna

                function getValues(love, hunger, fun, bath, tired) {

                  var mood =
                    tamagotchi.love +
                    tamagotchi.hunger +
                    tamagotchi.fun +
                    tamagotchi.bath +
                    tamagotchi.tired;
                  console.log("love = " + tamagotchi.love,
                    "hunger = " + tamagotchi.hunger +
                    "fun = " + tamagotchi.fun +
                    "bath = " + tamagotchi.bath +
                    "tired = " + tamagotchi.tired);
                }

                /*********  RÖRELSE   ******/

                // Funktionen tamaSlide loopar bilderna i tamagotchi klassen men visar bara dom 2 första för att det ska se ut som snigeln rör sig
                var slideshow = 0;

                function tamaSlide() {
                  var mood =
                    tamagotchi.love +
                    tamagotchi.hunger +
                    tamagotchi.fun +
                    tamagotchi.bath +
                    tamagotchi.tired;
                  var tama = document.getElementsByClassName("tamagotchi");
                  for (var i = 0; i < tama.length; i++) {
                    tama[i].style.display = "none";
                  }
                  slideshow++;
                  if (mood > 20) {
                    if (slideshow > 2) {
                      slideshow = 1;
                    }
                    tama[slideshow - 1].style.display = "block";
                  } else {
                    if (mood >= 11 && mood <= 19) {
                      if (slideshow > 5) {
                        slideshow = 4;
                      }
                      tama[slideshow - 1].style.display = "block";
                    } else {
                      if (slideshow > 7) {
                        slideshow = 6;
                      }
                      tama[slideshow - 1].style.display = "block";
                    }
                  }
                }

                // Funktionen flip gör att snigeln rör sig fram och tillbaka och flippar bilden så den går i rätt riktning
                var x = 200;
                var riktning = "höger";
                //const maxWidth = window.innerWidth;

                function flip() {
                  element = document.getElementById("tamaDiv");
                  element.style.right = x + "px";

                  if (riktning == "höger") {
                    x = x + 1;
                    element.style.transform = "scaleX(1)";
                  } else if (riktning == "vänster") {
                    x = x - 1;
                    document.getElementById("tamaDiv").style.transform = "scaleX(-1)"; // flippar bilden för att snigeln ska gå i rätt riktning
                  }
                  if (x == 800) {
                    riktning = "vänster";
                  } else if (x == 200) {
                    riktning = "höger";
                  }
                }

                var tamaMove = setInterval(tamaSlide, 900);
                var tamaFlip = setInterval(flip, 30);

                // Startar och stoppar tamaMove och flip funktionerna

                function stop() {
                  clearInterval(tamaMove);
                  clearInterval(tamaFlip);
                }

                function start() {
                  tamaMove = setInterval(tamaSlide, 900);
                  tamaFlip = setInterval(flip, 30);
                }

            </script>
</head>
  <body>
    <div id="gamecontainer">
      <div id="container">
      <div id="tamaDiv">
        <div class="tamagotchi"><img src="Images/tama1png.png" /></div>
        <div class="tamagotchi"><img src="Images/tama2png.png" /></div>
        <div class="tamagotchi"><img src="Images/tamahappy.png" /></div>
        <div class="tamagotchi"><img src="Images/tamaunhappy.png" /></div>
        <div class="tamagotchi"><img src="Images/tamaunhappy2.png" /></div>
        <div class="tamagotchi"><img src="Images/tamasad.png" /></div>
        <div class="tamagotchi"><img src="Images/tamasad2.png" /></div>
      </div>
    </div>
    </div>
  </body>
</html>
